{% extends "base.html" %}
{% block title %}Settings – Podfolio{% endblock %}

{% block content %}
<div class="container py-5">
  <h2>Account Settings</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-3">
        {% for cat, msg in messages %}
          <div class="alert alert-{{cat}}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" action="{{ url_for('main.settings') }}">
    <!-- Display Name -->
    <div class="mb-3">
      <label class="form-label">Display Name</label>
      <input type="text" name="display_name" class="form-control"
             value="{{ user.display_name }}">
    </div>

    <!-- Email -->
    <div class="mb-3">
      <label class="form-label">Email Address</label>
      <input type="email" name="email" class="form-control"
             value="{{ user.email }}">
    </div>

    <hr>

    <!-- Change Password -->
    <h4>Change Password</h4>
    <div class="mb-3">
      <label class="form-label">Current Password</label>
      <input type="password" name="current_password" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">New Password</label>
      <input type="password" id="new_password" name="new_password" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Confirm New Password</label>
      <input type="password" id="confirm_new_password" name="confirm_new_password"
             class="form-control">
    </div>

    <!-- Password Requirements Box -->
    <div class="mb-3">
      <div class="bg-white text-dark border rounded p-3">
        <ul class="mb-0 list-unstyled" id="pw-reqs">
          <li id="req-length"><i class="fa fa-times me-1"></i> ≥8 characters</li>
          <li id="req-upper"><i class="fa fa-times me-1"></i> Uppercase letter</li>
          <li id="req-lower"><i class="fa fa-times me-1"></i> Lowercase letter</li>
          <li id="req-number"><i class="fa fa-times me-1"></i> Number</li>
          <li id="req-special"><i class="fa fa-times me-1"></i> Special character</li>
        </ul>
      </div>
    </div>

    <button type="submit" class="btn btn-primary">Save Settings</button>
  </form>

  <!-- Delete Account -->
  <hr>
  <h4 class="mt-4 text-danger">Delete Account</h4>
  <p class="text-white">
    This is irreversible. All your data will be permanently removed.
  </p>

  <button type="button"
          id="delete-account-btn"
          class="btn btn-outline-danger">
    Delete Account
  </button>

  <form id="delete-account-form"
        method="POST"
        action="{{ url_for('main.delete_account') }}"
        style="display:none;"
        class="mt-3">
    <div class="mb-3">
      <label for="delete-confirm-input" class="form-label">
        Type <strong>DELETE</strong> to confirm:
      </label>
      <input type="text"
             id="delete-confirm-input"
             name="confirmation"
             class="form-control">
    </div>
    <button type="submit"
            id="delete-confirm-btn"
            class="btn btn-danger"
            disabled>
      Confirm Delete
    </button>
  </form>
</div>

<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
