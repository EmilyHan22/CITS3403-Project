{% extends "base.html" %}

{% block title %}Visualise – Podfolio{% endblock %}

{% block content %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="/static/js/dashboard_charts.js"></script>
<h1>Your listening insights</h1>

<div id="my-charts" style="background-color: plum; border-radius: 50px; margin-bottom: 50px; padding: 20px 7px;">
	<div id="podcast-chart-row-1" class="top-row-graphs" style="display: flex; justify-content: center; margin: 0 auto;">
		<div id="horizontal-barchart" class="chart-box"></div>
		<div id="listen-line-graph" class="chart-box"></div>
	</div>

	<div id="podcast-chart-row-2" style="display: flex; justify-content: center; margin: 0 auto;">
	<!-- ─── Top 5 Podcasts ─────────────────────────────────── -->
		<div id="top-five-section" class="me-4" style="margin:2em 0; max-width: 400px;">
			<h2>Your Top 5 Podcasts</h2>
			<p>Here are your top 5 podcasts of the month!</p>

			<ul class="top5-list list-group list-group-flush">
			{% if top5 %}
				{% for name, mins in top5 %}
				<li class="top5-list-item 
							list-group-item 
							d-flex align-items-center 
							bg-white rounded-pill 
							mb-2 shadow-sm 
							py-2 px-3">
					<span class="top5-rank fw-bold text-primary me-3">
					{{ loop.index }}.
					</span>
					<span class="top5-podcast-name flex-grow-1 text-truncate">
					{{ name }}
					</span>
					<span class="top5-duration badge bg-secondary rounded-pill ms-3">
					{{ mins }} min
					</span>
				</li>
				{% endfor %}
			{% else %}
				<li class="top5-list-item list-group-item">
				No listening history yet.
				</li>
			{% endif %}
			</ul>
		</div>

		<!-- ─── Most Loved Podcast ────────────────────────────── -->
		<div id="most-loved-section" style="margin:2em 0; max-width: 400px;">
			<h2 class="most-loved-title text-center mb-3">MOST LOVED</h2>

			{% if most_loved %}
			<div class="star-rating d-flex justify-content-center mb-3">
				{# full stars #}
				{% for _ in range(most_loved.rating|int) %}
				<span class="star filled text-warning fs-2 mx-1">&#9733;</span>
				{% endfor %}
				{# empty stars #}
				{% for _ in range(5 - (most_loved.rating|int)) %}
				<span class="star text-warning-50 fs-2 mx-1">&#9734;</span>
				{% endfor %}
			</div>
			<p class="most-loved-text text-center text-muted">
				You found <em>{{ most_loved.name }}</em><br>
				the most interesting with an average rating of 
				<strong>{{ most_loved.rating }}</strong> stars!
			</p>
			{% else %}
			<p class="most-loved-text text-center text-muted">
				You haven’t rated anything yet.
			</p>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %}