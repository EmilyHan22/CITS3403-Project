{% extends "base.html" %}

{% block title %}
Podcast Log â€“ Podfolio
{% endblock %}

{% block content %}

<!-- Greeting -->
<div class="greeting">
	<h1>ðŸ‘‹ Welcome Back!</h1>
	<p>Listened to another podcast? Tell us about it!</p>
</div>

<!-- Form Centered -->
<div class="form-container">
	<form class="podcast-form">

		<div class="mb-3" style="position: relative;">
			<label for="podcastName" class="form-label">Which Podcast did you listen to?</label>
			<input type="text" class="form-control" id="podcastName" placeholder="Start typing podcast name..." autocomplete="off">
			<input type="hidden" id="selectedPodcastId">
			<div id="podcastSuggestions" class="autocomplete-dropdown"></div>
		</div>

		<div class="mb-3">
			<label for="podcastEp" class="form-label">Which episode?</label>
			<input type="text" class="form-control" id="podcastEp" placeholder="Enter Podcast Episode Title">
		</div>

		<div class="mb-3">
			<label for="platform" class="form-label">Which platform did you use?</label>
			<input type="text" class="form-control" id="platform" placeholder="e.g. Spotify">
		</div>

		<div class="mb-3">
			<label for="listenTime" class="form-label">How many minutes did you listen for?</label>
			<input type="number" class="form-control" id="listenTime" placeholder="E.g. 45">
		</div>

		<div class="mb-3">
			<label for="genre" class="form-label">What Genre is the Podcast?</label>
			<select class="form-select" id="genre">
				<option selected disabled>Select</option>
				<option value="Educational">Educational</option>
				<option value="News">News</option>
				<option value="Interview">Interview</option>
				<option value="Politics">Politics</option>
				<option value="Society and Culture">Society and Culture</option>
				<option value="Sports">Sports</option>
				<option value="Musical">Musical</option>
				<option value="Comedy">Comedy</option>
				<option value="Narrative">Narrative</option>
				<option value="Crime and Mystery">Crime and Mystery</option>
				<option value="Business and Economy">Business and Economy</option>
				<option value="Lifestyle and Health">Lifestyle and Health</option>
				<option value="Technology and Development">Technology and Development</option>
				<option value="Other">Other</option>
			</select>
		</div>

		<div class="mb-3">
			<label class="form-label">Rate it!</label>
			<div class="star-rating">
				<input type="radio" id="star5" name="rating" value="5" hidden />
				<label for="star5">â˜…</label>

				<input type="radio" id="star4" name="rating" value="4" hidden />
				<label for="star4">â˜…</label>

				<input type="radio" id="star3" name="rating" value="3" hidden />
				<label for="star3">â˜…</label>

				<input type="radio" id="star2" name="rating" value="2" hidden />
				<label for="star2">â˜…</label>

				<input type="radio" id="star1" name="rating" value="1" hidden />
				<label for="star1">â˜…</label>
			</div>
		</div>

		<button type="submit" class="btn-log">Log It!</button>
	</form>
</div>

	
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		const podcastInput = document.getElementById('podcastName');
		const podcastIdInput = document.getElementById('selectedPodcastId');
		const suggestionsContainer = document.getElementById('podcastSuggestions');
		let debounceTimer;
	
		podcastInput.addEventListener('input', function() {
			clearTimeout(debounceTimer);
			const query = this.value.trim();
			
			if (query.length < 2) {
				suggestionsContainer.style.display = 'none';
				return;
			}
			
			debounceTimer = setTimeout(() => {
				fetch(`/search_podcast_names?q=${encodeURIComponent(query)}`)
					.then(response => response.json())
					.then(podcasts => {
						suggestionsContainer.innerHTML = '';
						
						if (podcasts.length === 0) {
							suggestionsContainer.style.display = 'none';
							return;
						}
						
						podcasts.forEach(podcast => {
							const item = document.createElement('div');
							item.className = 'autocomplete-item';
							item.textContent = podcast.name;
							item.addEventListener('click', () => {
								podcastInput.value = podcast.name;
								podcastIdInput.value = podcast.id;
								suggestionsContainer.style.display = 'none';
							});
							suggestionsContainer.appendChild(item);
						});
						
						suggestionsContainer.style.display = 'block';
					});
			}, 300);
		});
	
		// Hide dropdown when clicking outside
		document.addEventListener('click', function(e) {
			if (e.target !== podcastInput) {
				suggestionsContainer.style.display = 'none';
			}
		});
	
		// Form submission remains exactly the same
		document.getElementById('podcastForm').addEventListener('submit', function(e) {
			e.preventDefault();
			// Your existing form submission logic here
		});
	});
	</script>
	
{% endblock %}
